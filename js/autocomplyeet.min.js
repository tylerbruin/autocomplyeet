// Autocomplyeet 1.0 - https://github.com/tylerbruin/autocomplyeet
function ajaxRequest(e,t,n,a){let r=new XMLHttpRequest;r.open(e,t,!0),"POST"==e&&r.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),r.onreadystatechange=function(){if(4==r.readyState&&200==r.status){let e=r.responseText;a(e)}},r.send(n)}function autocomplyeet(e){const t=document.querySelector(e.id);t.setAttribute("autocomplete","off");const n=document.createElement("ul");n.setAttribute("id","ac-list");const a=document.createElement("div");a.classList.add("ac-container"),t.parentNode.insertBefore(a,t),a.appendChild(t),a.appendChild(n),t.addEventListener("focusout",function(e){null==e.relatedTarget?(n.innerHTML="",a.setAttribute("data-before","")):"ac-item"!==e.relatedTarget.className&&(n.innerHTML="",a.setAttribute("data-before",""))}),t.addEventListener("input",function(){if(t.value.length>2){var r=e.server+t.value;ajaxRequest("GET",r,null,function(e){var r=JSON.parse(e);if(r.length>0){var i=r[0];i=i.substring(t.value.length),i=t.value+i,a.setAttribute("data-before",i),n.innerHTML="",n.style.width=t.offsetWidth+"px";for(var s=0;s<r.length;s++){var u=document.createElement("li"),l=r[s].replace(new RegExp("("+t.value.toLowerCase()+")"),'<span class="ac-highlight">'+t.value+"</span>");u.innerHTML=l,u.setAttribute("tabindex","1"),u.classList.add("ac-item"),n.appendChild(u),u.addEventListener("keydown",function(e){"ArrowDown"==e.key?(e.preventDefault(),this.nextSibling.focus()):"ArrowUp"==e.key?null!==this.previousSibling?(e.preventDefault(),this.previousSibling.focus()):t.focus():"Enter"==e.key&&(e.preventDefault(),a.setAttribute("data-before",""),t.value=this.innerText,t.focus())}),u.addEventListener("click",function(e){t.value=this.innerText,n.innerHTML="",a.setAttribute("data-before",""),t.focus()}),u.addEventListener("focusout",function(e){if(null==e.relatedTarget)n.innerHTML="",a.setAttribute("data-before","");else{if("ac-item"==e.relatedTarget.className||"search"==e.relatedTarget.id)return!1;n.innerHTML="",a.setAttribute("data-before","")}})}}else n.innerHTML="",a.setAttribute("data-before","")})}else n.innerHTML="",a.setAttribute("data-before","")}),t.addEventListener("keydown",function(e){t.value.length>2&&"ArrowDown"==e.key&&null!==document.querySelector("#ac-list li")&&(e.preventDefault(),document.querySelector("#ac-list li:first-child").focus())})}